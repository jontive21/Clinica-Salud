extends ../layout

block content
  h1 #{title}

  // Sección de Información del Paciente
  if paciente && paciente.id
    div.card.mt-3.mb-3
      div.card-header Detalles del Paciente
      div.card-body
        p.card-text
          strong Nombre:
          | #{paciente.nombre} #{paciente.apellido}
        p.card-text
          strong DNI:
          | #{paciente.dni}
        p.card-text
          a(href=`/pacientes/${paciente.id}`) Ver Registro Completo del Paciente

  // Sección de Información de la Admisión
  if admision
    div.card.mt-3
      div.card-header Detalles de la Admisión
      div.card-body
        dl.row
          dt.col-sm-4 ID de Admisión
          dd.col-sm-8= admision.id

          dt.col-sm-4 Fecha de Admisión
          dd.col-sm-8= admision.fecha_admision ? new Date(admision.fecha_admision).toLocaleString() : 'N/A'

          dt.col-sm-4 Tipo de Admisión
          dd.col-sm-8= admision.tipo_admision

          dt.col-sm-4 Médico Referente
          dd.col-sm-8= admision.medico_referente || 'N/A'

          dt.col-sm-4 Diagnóstico Inicial
          dd.col-sm-8
            pre= admision.diagnostico_inicial || 'N/A'

          dt.col-sm-4 Estado de Admisión
          dd.col-sm-8
            span(class=`badge badge-${admision.estado_admision === 'Activa' ? 'success' : (admision.estado_admision === 'Completada' ? 'info' : 'secondary')}`)= admision.estado_admision

          if admision.fecha_alta
            dt.col-sm-4 Fecha de Alta/Finalización
            dd.col-sm-8= new Date(admision.fecha_alta).toLocaleString()

          if admision.cama_asignada_id
            //- Idealmente, aquí se mostraría el código de la cama, pero requeriría otro JOIN o carga de datos.
            //- Por ahora, solo el ID es suficiente para el contexto básico.
            dt.col-sm-4 Cama Asignada ID
            dd.col-sm-8= admision.cama_asignada_id
          else if admision.estado_admision === 'Activa'
            dt.col-sm-4 Cama Asignada
            dd.col-sm-8.text-muted Ninguna cama asignada actualmente.


    // Acciones de Admisión
    div.mt-4
      h4 Acciones de Admisión
      div.d-flex.flex-wrap.align-items-start // Usar flex para mejor alineación y wrap
        // Formulario para Actualizar Estado
        form(method="POST" action=`/admisiones/${admision.id}/actualizar-estado` class="mb-2 me-2") // me-2 para margen a la derecha
          div.input-group
            label(for="nuevo_estado" class="input-group-text") Nuevo Estado:
            select#nuevo_estado.form-select(name="nuevo_estado" required)
              option(value="Activa" selected=admision.estado_admision === 'Activa') Activa
              option(value="Completada" selected=admision.estado_admision === 'Completada') Completada
              option(value="Cancelada" selected=admision.estado_admision === 'Cancelada') Cancelada
            button(type="submit" class="btn btn-warning") Actualizar Estado

        if admision.estado_admision === 'Activa'
          // Botón para Asignar Cama (si no hay cama asignada)
          if !admision.cama_asignada_id
            a(href=`/asignaciones-cama/admision/${admision.id}/asignar-cama/ui` class="btn btn-primary mb-2 me-2") Asignar Cama

          // Botón para Liberar Cama (si hay cama asignada)
          if admision.cama_asignada_id
            form(method="POST" action=`/asignaciones-cama/admision/${admision.id}/liberar-cama` class="mb-2 me-2")
              button(type="submit" class="btn btn-info" onclick="return confirm('¿Está seguro de que desea liberar la cama para esta admisión?');") Liberar Cama Asignada

      // Enlaces a Evaluaciones (simplificados)
      div.mt-3
        h5 Evaluaciones Relacionadas
        a(href=`/evaluaciones-enfermeria/admision/${admision.id}/nueva` class="btn btn-outline-success mb-2 me-2") Gestionar Evaluación Enfermería
        a(href=`/evaluaciones-medicas/admision/${admision.id}/nueva` class="btn btn-outline-primary mb-2 me-2") Registrar Nueva Evaluación Médica
        //- Si existiera una vista para listar todas las evaluaciones médicas de una admisión:
        //- a(href=`/evaluaciones-medicas/admision/${admision.id}` class="btn btn-outline-info mb-2 me-2") Ver Evaluaciones Médicas

  else
    p.mt-3.alert.alert-warning Datos de la admisión no disponibles.

  hr
  div.mt-3
    if paciente && paciente.id
      a(href=`/pacientes/${paciente.id}` class="btn btn-secondary") Volver a Detalles del Paciente
    else if admision && admision.paciente_id
      // Este caso es por si el objeto 'paciente' no se cargó por alguna razón pero tenemos el ID
      a(href=`/pacientes/${admision.paciente_id}` class="btn btn-secondary") Volver a Detalles del Paciente
    else
      a(href="/pacientes" class="btn btn-secondary") Volver a Lista de Pacientes

    //- TODO: Agregar enlace para "Editar Admisión" si se implementa esa funcionalidad.
    //- La edición de una admisión podría ser compleja (qué campos son editables después de creada?).
    //- Por ahora, se enfoca en el cambio de estado y asignación de cama.
```
